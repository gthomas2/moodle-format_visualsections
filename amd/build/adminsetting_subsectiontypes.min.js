define ("format_visualsections/adminsetting_subsectiontypes",["jquery","core/templates","core/modal_factory","core/modal_events","core/fragment","core/ajax","format_visualsections/dialog","core/str"],function(a,b,c,d,e,f,g,h){return{init:function init(){var i=function(){var b=[];a(".subsectiontypes ul li").each(function(){var c=a(this).find("[name*=\"code\"]").val(),d=a(this).find("[name*=\"name\"]").val(),e=a(this).find("button.imagethumb").data("imgsrc");if("undefined"==typeof e){e=null}c=c.replace("|"," ");d=d.replace("|"," ");b.push(c+"|"+d+"|"+e)});var c=a(".subsectiontypes .js-data-field");a(c).val(b.join("\n"))};a(".subsectiontypes").on("click",".js-addsubsection",function(c){c.preventDefault();var d=0;a(".subsectiontypes .subsectiontyperow").each(function(){var b=a(this).data("pos");if(b&&b>d){d=b}});var e={pos:d+1,code:null,name:null,image:null};b.render("format_visualsections/subsectiontyperow",e).then(function(b){a(".subsectiontypes ul").append(b)})});a(".subsectiontypes").on("keyup change","input",function(a){a.preventDefault();i()});a(".subsectiontypes").on("click",".js-removesubsection",function(b){b.preventDefault();a(this).parent("li").remove();i()});var j=null,k=function(){a("#image-upload").html("<div class=\"spinner\"></div>");j.show();return e.loadFragment("format_visualsections","filepicker",M.cfg.contextid,[]).done(function(c,d){if(!a("#image-upload").length){return}b.replaceNodeContents(a("#image-upload"),c,d)})},l=!1,m=function(e,m){if(j){j.rowEl=e;j.rowData=m;k();return}if(l){return}l=!0;c.create({type:c.types.SAVE_CANCEL,title:"Add image",body:"<div id=\"image-upload\"></div>"}).then(function(c){j=c;j.setSmall();j.rowEl=e;j.rowData=m;k();j.getRoot().on(d.save,function(){var d=a(".filepicker-filename a").attr("href"),e=/(?:draftfile.php\/)(.*)$/,j=d.match(e),k=j[1].split("/"),l=k[3],m=k[4];return f.call([{methodname:"format_visualsections_subtopic_addimage",args:{request:{draftitemid:l,filename:m}}}])[0].then(function(d){if(!d.success){h.get_string("failedtouploadimage","format_visualsections").then(function(a){g.error(a,"")})}var e=d.imagefile;c.rowData.image=e;b.render("format_visualsections/subsectiontyperow",c.rowData).then(function(b){a(c.rowEl).replaceWith(b);i()})})});c.getRoot().on(d.hidden,function(){a("#image-upload").html("")})})};a(".subsectiontypes").on("click",".js-setimage",function(b){b.preventDefault();var c=a(this).parent(".subsectiontyperow"),d=a(c).find("[name*=\"code\"]").val(),e=a(c).find("[name*=\"name\"]").val(),f=a(this).data("imgsrc");m(c,{code:d,name:e,image:f})});a(".subsectiontypes").addClass("jsloaded")}}});
//# sourceMappingURL=adminsetting_subsectiontypes.min.js.map
