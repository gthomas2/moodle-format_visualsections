{"version":3,"sources":["../src/adminsetting_subsectiontypes.js"],"names":["define","$","Templates","ModalFactory","ModalEvents","Fragment","init","rewriteDataField","data","each","code","find","val","name","replace","push","dataField","join","on","e","preventDefault","greatestPos","count","pos","alert","render","then","html","append","parent","remove","imageModal","showImageModal","show","loadFragment","M","cfg","contextid","done","js","length","replaceNodeContents","addImageModal","create","type","types","SAVE_CANCEL","title","body","modal","setSmall","getRoot","save","hidden","destroy"],"mappings":"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","sourcesContent":["define([\"jquery\",\n    \"core/templates\",\n    \"core/modal_factory\",\n    \"core/modal_events\",\n    \"core/fragment\"], function($, Templates, ModalFactory, ModalEvents, Fragment) {\n    return {\n        init: function() {\n            var rewriteDataField = function() {\n                var data = [];\n                $('.subsectiontypes ul li').each(function() {\n                    var code = $(this).find('[name*=\"code\"]').val();\n                    var name = $(this).find('[name*=\"name\"]').val();\n                    code = code.replace('|', ' '); // No pipes allowed.\n                    name = name.replace('|', ' '); // No pipes allowed.\n                    data.push(code+'|'+name);\n                });\n                var dataField = $('.subsectiontypes .js-data-field');\n                $(dataField).val(data.join(\"\\n\"));\n            };\n\n            // Listen for add sub section.\n            $('.subsectiontypes').on('click', '.js-addsubsection', function(e) {\n                e.preventDefault();\n                var greatestPos = 0;\n\n                var count = 0;\n                $('.subsectiontypes .subsectiontyperow').each(function() {\n                    count ++;\n                    var pos = $(this).data('pos');\n                    if (pos && pos > greatestPos) {\n                        greatestPos = pos;\n                    }\n                });\n\n                if (count > 4) {\n                    // TODO localise.\n                    alert ('Max sub sections 5');\n                    return;\n                }\n\n                var data = {\n                    pos: greatestPos + 1,\n                    code: null,\n                    name: null\n                };\n                Templates.render('format_visualsections/subsectiontyperow', data)\n                    .then(function(html) {\n                        $('.subsectiontypes ul').append(html);\n                    });\n            });\n\n            // Listen for field value changes.\n            $('.subsectiontypes').on('keyup change', 'input', function(e) {\n                e.preventDefault();\n                rewriteDataField();\n            });\n\n            // Listen remove sub section.\n            $('.subsectiontypes').on('click', '.js-removesubsection', function(e) {\n                e.preventDefault();\n                $(this).parent('li').remove();\n                rewriteDataField();\n            });\n\n            var imageModal = null;\n\n            var showImageModal = function() {\n                $('#image-upload').html('<div class=\"spinner\"></div>');\n                imageModal.show();\n                return Fragment.loadFragment(\"format_visualsections\", \"fragment_filepicker\", M.cfg.contextid, [])\n                    .done(function(html, js) {\n                        if (!$(\"#image-upload\").length) {\n                            return;\n                        }\n                        Templates.replaceNodeContents(\n                            $(\"#image-upload\"),\n                            html,\n                            js\n                        );\n                    });\n            };\n\n            var addImageModal = function() {\n                if (imageModal) {\n                    showImageModal();\n                    return;\n                }\n                ModalFactory.create({\n                    type: ModalFactory.types.SAVE_CANCEL,\n                    title: \"Add image\",\n                    body: `<div id=\"image-upload\"></div>`\n                })\n                .then(function(modal) {\n                    imageModal = modal;\n                    modal.setSmall();\n                    showImageModal();\n\n                    /*$('#image-upload').append($('.filepicker-cont'));\n                    $('#image-upload .filepicker-cont').css('display', 'block');\n                    */\n\n                    // Handle save event.\n                    modal.getRoot().on(ModalEvents.save, function() {\n\n                    });\n\n                    modal.getRoot().on(ModalEvents.hidden, function() {\n                        modal.destroy();\n                    });\n                });\n            };\n\n            // Listen add image.\n            $('.subsectiontypes').on('click', '.js-setimage', function(e) {\n                e.preventDefault();\n                addImageModal();\n            });\n        }\n    };\n});"],"file":"adminsetting_subsectiontypes.min.js"}