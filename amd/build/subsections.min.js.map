{"version":3,"sources":["../src/subsections.js"],"names":["define","$","Y","ModalFactory","ModalEvents","Ajax","Fragment","Templates","Str","Event","Utils","SectionCircle","Carousel","consts","SUBSECTION_FORM_CONT","CAROUSEL_CONT","FOOTER","init","courseId","capViewAllGrades","defaultSection","modalSubsection","sectionId","applySegments","use","each","DD","Drop","node","attr","loadSubsectionForm","data","String","URLSearchParams","toString","contextid","M","cfg","params","formdata","loadFragment","done","html","js","length","replaceNodeContents","initModal","dfd","Deferred","bodyHTML","create","title","type","body","large","then","modal","getRoot","on","save","e","preventDefault","form","trigger","serialize","modalEl","getModal","find","subsectionId","val","window","onbeforeunload","location","wwwroot","hide","reload","cancel","setBody","resolve","addSubsectionModal","el","section","closest","subSectionCount","alert","get_strings","key","component","strings","setTitle","show","parentid","editSubsectionModal","subSectionId","id","course","applySubsectionHash","hash","addClass","subsectionSel","whenTrue","collapse","setTimeout","nav","subtractTop","outerHeight","animate","scrollTop","offset","top","applySectionHash","removeClass","sectionHash","subSectionCont","parents","parent","regex","match","sectionNum","carouselItem","c","pos","hasClass","contextId","courseid","replaceNode","tooltip","applyHash","calledOnDomReady","indexOf","ready","activityCompletionToggled","getLegacyEvents","events","document","FILTER_CONTENT_UPDATED","direction","src","srcSectionId","target","prev","next","parentSection","parentSectionId","targetSectionId","after","before","targetParentSection","append","call","methodname","args","result","success"],"mappings":"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","sourcesContent":["define(\n    [\n        \"jquery\",\n        \"core/yui\",\n        \"core/modal_factory\",\n        \"core/modal_events\",\n        \"core/ajax\",\n        \"core/fragment\",\n        \"core/templates\",\n        \"core/str\",\n        \"core/event\",\n        \"format_visualsections/utils\",\n        \"format_visualsections/sectioncircle\",\n        \"format_visualsections/carousel\"\n    ],\n    function($, Y, ModalFactory, ModalEvents, Ajax, Fragment, Templates, Str, Event, Utils, SectionCircle, Carousel) {\n    var consts = {\n        SUBSECTION_FORM_CONT: \"subsectionformcontainer\",\n        CAROUSEL_CONT: \"section-carousel-content\",\n        FOOTER: \"format-footer\"\n    };\n    return {\n        init: function(courseId, capViewAllGrades, defaultSection) {\n            var modalSubsection = null;\n            var sectionId = null;\n\n            SectionCircle.applySegments(courseId);\n\n            Y.use(\"dd-drop\", function(Y) {\n                $(\".subsection\").each(function() {\n                    new Y.DD.Drop({\n                        node: \"#\"+$(this).attr(\"id\")\n                    });\n                });\n            });\n\n            var loadSubsectionForm = function(data) {\n                if (typeof data !== \"string\" && !(data instanceof String)) {\n                    data = new URLSearchParams(data).toString();\n                }\n                const contextid = M.cfg.contextid;\n                const params = data ? {formdata: data} : null;\n\n                return Fragment.loadFragment(\"format_visualsections\", \"subsection_form\", contextid, params)\n                    .done(function(html, js) {\n                        if (!$(\"#\" + consts.SUBSECTION_FORM_CONT).length) {\n                            return;\n                        }\n                        Templates.replaceNodeContents(\n                            $(\"#\" + consts.SUBSECTION_FORM_CONT),\n                            html,\n                            js\n                        );\n                    });\n            };\n\n            var initModal = function() {\n                var dfd = $.Deferred();\n                var bodyHTML = `<div id=\"${consts.SUBSECTION_FORM_CONT}\"></div>`;\n\n                if (!modalSubsection) {\n                    ModalFactory.create({\n                        title: \"\",\n                        type: \"SAVE_CANCEL\",\n                        body: bodyHTML,\n                        large: true,\n                    }).then(function(modal) {\n                        modalSubsection = modal;\n                        modal.getRoot().on(ModalEvents.save, function(e) {\n                            e.preventDefault(); // We don\"t want to close the modal yet.\n                            var form = $(\"#\" + consts.SUBSECTION_FORM_CONT + \" form\");\n                            $(form).trigger(\"save-form-state\");\n\n                            var data = $(form).serialize();\n                            loadSubsectionForm(data)\n                                .then(function() {\n                                    const modalEl = modal.getModal();\n                                    if (modalEl.find(\".alert-success\").length) {\n                                        const subsectionId = modalEl.find(\"form input[name='id']\").val();\n                                        window.onbeforeunload = null;\n                                        window.location = M.cfg.wwwroot+\"/course/view.php?id=\"+courseId+\"#subsection\"+subsectionId;\n                                        modal.hide();\n                                        window.location.reload();\n                                    }\n                                });\n\n                        });\n                        modal.getRoot().on(ModalEvents.cancel, function() {\n                            modal.hide();\n                        });\n                        modal.getRoot().on(ModalEvents.hide, function() {\n                            modal.setBody(\"\");\n                        });\n                        dfd.resolve(modal);\n                    });\n                } else {\n                    dfd.resolve(modalSubsection);\n                }\n                return dfd;\n            };\n\n            var addSubsectionModal = function(el) {\n                sectionId = $(el).data(\"sectionid\");\n                var section = $(el).closest(\".section\");\n                var subSectionCount = section.find(\".subsections .subsection\").length;\n\n                if (subSectionCount >= 5) {\n                    // TODO\n                    alert (\"too many sections\");\n                    return;\n                }\n\n                initModal()\n                .then(function() {\n                    return  Str.get_strings([\n                        {key: \"addsubsection\", component: \"format_visualsections\"}\n                    ]);\n                })\n                .then(function(strings) {\n                    modalSubsection.setTitle(strings[0]);\n                    modalSubsection.show();\n                    $(\"#\"+consts.SUBSECTION_FORM_CONT).html(`<div class=\"spinner\"></div>`);\n                    loadSubsectionForm({parentid: sectionId});\n                });\n            };\n\n            $(\"body\").on(\"click\", \".js-add-subsection\", function() {addSubsectionModal(this);});\n\n            var editSubsectionModal = function(el) {\n                var subSectionId = $(el).closest(\".subsection\").data(\"subsection-id\");\n                initModal().then(function() {\n                    return  Str.get_strings([\n                        {key: \"editsubsection\", component: \"format_visualsections\"}\n                    ]);\n                }).then(function(strings) {\n                    modalSubsection.setTitle(strings[0]);\n                    modalSubsection.show();\n                    $(\"#\"+consts.SUBSECTION_FORM_CONT).html(`<div class=\"spinner\"></div>`);\n                    loadSubsectionForm({id: subSectionId, course: courseId});\n                });\n\n            };\n\n            $(\"body\").on(\"click\", \".js-edit-subsection\", function() {editSubsectionModal(this);});\n\n            var applySubsectionHash = function(hash) {\n                $(\"#section-carousel\").addClass(\"carousel-ready\");\n                var subsectionSel = hash+\" > .section\";\n                Utils.whenTrue(function() {\n                    return typeof(window.$(subsectionSel).collapse) === \"function\";\n                }).then(function() {\n                    window.$(subsectionSel).collapse(\"show\");\n                    setTimeout(function() {\n                        const nav = $(\".fixed-top.navbar\");\n                        // We need to account for a fixed navbar.\n                        // If there is one then scroll the page to the current hashed\n                        // item but subtract the top by the height of the fixed nav bar.\n                        var subtractTop = nav.length ? nav.outerHeight() : 40;\n                        $(\"html, body\").animate({\n                            scrollTop: $(hash).offset().top - subtractTop\n                        }, 200);\n                    }, 200);\n\n                });\n            };\n\n            var applySectionHash = function(hash) {\n                let section = $(hash);\n                $(\"ul.visualsections > li.section\").removeClass(\"active\");\n                $(hash).addClass(\"active\");\n\n                let sectionHash;\n                const subSectionCont = $(section).parents('div.subsection');\n                if (subSectionCont.length) {\n                    // This is a subsection. We want the parent section to be active too.\n                    var parent =  $(subSectionCont).parents('li.section');\n                    $(parent).addClass(\"active\");\n                    // Also the carousel item needs to be the parent section.\n                    sectionHash = $(parent).attr('id');\n                } else {\n                    sectionHash = hash;\n                }\n\n                // Make carousel active.\n                const regex = /(?:section)-(\\d+)$/;\n                const match = sectionHash.match(regex);\n                const sectionNum = match[1];\n                const carouselItem = $(\"#section-circle-\" + sectionNum).closest(\".carousel-item\");\n\n                $(\"#section-carousel .carousel-item\").removeClass(\"active\");\n\n                carouselItem.addClass(\"active\");\n                let c = 0;\n                let pos = 0;\n                $(\"#section-carousel .carousel-item\").each(function() {\n                    c++;\n                    if ($(this).hasClass(\"active\")) {\n                        pos = c;\n                    }\n                });\n\n                $(\"#section-carousel .carousel-indicators li\").removeClass(\"active\");\n                $(\"#section-carousel .carousel-indicators li:nth-child(\" + pos + \")\").addClass(\"active\");\n\n                $(\"#section-carousel\").addClass(\"carousel-ready\");\n\n                const params = {courseid: courseId, section: sectionNum};\n                const contextId = M.cfg.contextid;\n                Fragment.loadFragment(\"format_visualsections\", \"footer\", contextId, params)\n                    .done(function(html, js) {\n                        if (!$(\"#\" + consts.FOOTER).length) {\n                            return;\n                        }\n                        Templates.replaceNode (\n                            $(\"#\" + consts.FOOTER),\n                            html,\n                            js\n                        );\n                        $(`#${consts.FOOTER} button[data-toggle=\"tooltip\"]`).tooltip();\n                    });\n            };\n\n            var applyHash = function(calledOnDomReady) {\n                const hash = location.hash;\n                if (hash.indexOf(\"#subsection\") === 0) {\n                    applySubsectionHash(hash);\n                } else if (hash.indexOf(\"#section\") === 0) {\n                    applySectionHash(hash);\n                } else if (calledOnDomReady && !capViewAllGrades) {\n                    // This is a student, open the default section for this student.\n                    location.hash = \"#\"+defaultSection;\n                } else {\n                    $(\"#section-carousel\").addClass(\"carousel-ready\");\n                }\n            };\n\n            $(\"document\").ready(function(e) {\n                applyHash(true, e);\n            });\n\n            $(window).on(\"hashchange\", function(e) {\n                applyHash(false, e);\n            });\n\n            // Track activity completion toggles.\n            let activityCompletionToggled = false;\n            $(\"body\").on(\"click\", \".togglecompletion\", function() {\n                activityCompletionToggled = true;\n            });\n\n            Event.getLegacyEvents().done(function(events) {\n                $(document).on(events.FILTER_CONTENT_UPDATED, function() {\n                    // Note: replaceNodeContents triggers FILTER_CONTENT_UPDATED,\n                    // so we have to use activityCompletionToggled to be more specific.\n                    if (!activityCompletionToggled) {\n                        return;\n                    }\n                    activityCompletionToggled = false;\n\n                    // Reload carousel.\n                    $('#section-carousel').removeClass('carousel-ready');\n                    const params = {courseid: courseId};\n                    const contextId = M.cfg.contextid;\n\n                    Fragment.loadFragment(\"format_visualsections\", \"carousel\", contextId, params)\n                        .done(function(html, js) {\n                            if (!$(\"#\" + consts.CAROUSEL_CONT).length) {\n                                return;\n                            }\n                            Templates.replaceNodeContents(\n                                $(\"#\" + consts.CAROUSEL_CONT),\n                                html,\n                                js\n                            );\n                            SectionCircle.applySegments(courseId);\n                            Carousel.init();\n                            applyHash();\n                        });\n                });\n            });\n\n            $(\"body\").on(\"click\", `#${consts.FOOTER} .js-nav`, function(e) {\n                e.preventDefault();\n                if ($(this).attr('disabled')) {\n                    return;\n                }\n                const section = $(this).data('section');\n                location.hash = \"#section-\" + section;\n            });\n\n            $(\"body\").on(\"click\", \".js-move-subsection\", function() {\n                const direction = $(this).data(\"direction\");\n                const src = $(this).closest(\"div.subsection\");\n                const srcSectionId = $(src).data(\"subsection-id\");\n                let target = null;\n\n                if (direction === \"up\") {\n                    target = $(src).prev(\"div.subsection\");\n                } else {\n                    target = $(src).next(\"div.subsection\");\n                }\n                let parentSection = $(this).closest(\"li.section\");\n                let parentSectionId = $(parentSection).data(\"section-id\");\n                let targetSectionId = null;\n\n                if (target.length) {\n                    if (direction === \"up\") {\n                        $(src).after(target);\n                    } else {\n                        $(src).before(target);\n                    }\n                    targetSectionId = $(target).data(\"subsection-id\");\n                } else {\n                    let targetParentSection = null;\n                    if (direction === \"up\") {\n                        targetParentSection = $(parentSection).prev(\"li.section\");\n                    } else {\n                        targetParentSection = $(parentSection).next(\"li.section\");\n                    }\n                    if (targetParentSection.length) {\n                        targetSectionId = srcSectionId; // We just want to dump it into parent section.\n                    } else {\n                        return; // Can\"t move any further.\n                    }\n                    parentSection = targetParentSection;\n                    parentSectionId = parentSection.data(\"section-id\");\n                    parentSection.find(\".subsections\").append(src);\n                }\n\n                Ajax.call([\n                    {\n                        methodname: \"format_visualsections_move_subtopic\",\n                        args:{\n                            \"request\": {\n                                \"parentsectionid\": parentSectionId,\n                                \"srcsectionid\": srcSectionId,\n                                \"targetsectionid\": targetSectionId\n                            }\n                        }\n                    }\n                ])[0]\n                    .then(function(result) {\n                        if (!result.success) {\n                            // TODO - localise.\n                            alert (\"Error: failed to move sub section\");\n                        }\n                    });\n            });\n        }\n    };\n});"],"file":"subsections.min.js"}