{"version":3,"sources":["../src/subsections.js"],"names":["define","$","Y","ModalFactory","ModalEvents","Ajax","Fragment","Templates","Str","Event","Utils","SectionCircle","Carousel","Dialog","consts","SUBSECTION_FORM_CONT","CAROUSEL_CONT","FOOTER","init","courseId","capViewAllGrades","defaultSection","modalSubsection","sectionId","applySegments","use","each","DD","Drop","node","attr","loadSubsectionForm","data","String","URLSearchParams","toString","contextid","M","cfg","params","formdata","loadFragment","done","html","js","length","replaceNodeContents","form","on","e","preventDefault","initModal","dfd","Deferred","bodyHTML","create","title","type","body","large","then","modal","getRoot","save","trigger","serialize","modalEl","getModal","find","subsectionId","val","window","onbeforeunload","location","wwwroot","hide","reload","cancel","setBody","resolve","addSubsectionModal","el","section","closest","subSectionCount","get_string","str","error","get_strings","key","component","strings","setTitle","show","parentid","editSubsectionModal","subSectionId","id","course","scrollTo","selector","yOffset","document","querySelector","y","getBoundingClientRect","top","pageYOffset","behavior","applySubsectionHash","hash","indexOf","replace","addClass","parentSection","applySectionHash","subsectionSel","whenTrue","collapse","setTimeout","nav","subtractTop","outerHeight","removeClass","sectionHash","subSectionCont","parents","parent","regex","match","sectionNum","carouselItem","c","pos","hasClass","contextId","courseid","replaceNode","tooltip","applyHash","calledOnDomReady","ready","activityCompletionToggled","getLegacyEvents","events","FILTER_CONTENT_UPDATED","direction","src","srcSectionId","target","prev","next","parentSectionId","targetSectionId","after","before","targetParentSection","append","call","methodname","args","result","success"],"mappings":"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","sourcesContent":["define(\n    [\n        \"jquery\",\n        \"core/yui\",\n        \"core/modal_factory\",\n        \"core/modal_events\",\n        \"core/ajax\",\n        \"core/fragment\",\n        \"core/templates\",\n        \"core/str\",\n        \"core/event\",\n        \"format_visualsections/utils\",\n        \"format_visualsections/sectioncircle\",\n        \"format_visualsections/carousel\",\n        \"format_visualsections/dialog\"\n    ],\n    function($, Y, ModalFactory, ModalEvents, Ajax, Fragment, Templates, Str, Event, Utils, SectionCircle, Carousel, Dialog) {\n        var consts = {\n            SUBSECTION_FORM_CONT: \"subsectionformcontainer\",\n            CAROUSEL_CONT: \"section-carousel-content\",\n            FOOTER: \"format-footer\"\n        };\n        return {\n            init: function(courseId, capViewAllGrades, defaultSection) {\n                var modalSubsection = null;\n                var sectionId = null;\n\n                SectionCircle.applySegments(courseId);\n\n                Y.use(\"dd-drop\", function(Y) {\n                    $(\".subsection\").each(function() {\n                        new Y.DD.Drop({\n                            node: \"#\"+$(this).attr(\"id\")\n                        });\n                    });\n                });\n\n                var loadSubsectionForm = function(data) {\n                    if (typeof data !== \"string\" && !(data instanceof String)) {\n                        data = new URLSearchParams(data).toString();\n                    }\n                    const contextid = M.cfg.contextid;\n                    const params = data ? {formdata: data} : null;\n\n                    return Fragment.loadFragment(\"format_visualsections\", \"subsection_form\", contextid, params)\n                        .done(function(html, js) {\n                            if (!$(\"#\" + consts.SUBSECTION_FORM_CONT).length) {\n                                return;\n                            }\n                            Templates.replaceNodeContents(\n                                $(\"#\" + consts.SUBSECTION_FORM_CONT),\n                                html,\n                                js\n                            );\n                            const form = \"#\" + consts.SUBSECTION_FORM_CONT + \" form\";\n                            $(form).on(\"submit\", function(e) {\n                                e.preventDefault();\n                                return false;\n                            });\n                        });\n                };\n\n                var initModal = function() {\n                    var dfd = $.Deferred();\n                    var bodyHTML = `<div id=\"${consts.SUBSECTION_FORM_CONT}\"></div>`;\n\n                    if (!modalSubsection) {\n                        ModalFactory.create({\n                            title: \"\",\n                            type: \"SAVE_CANCEL\",\n                            body: bodyHTML,\n                            large: true,\n                        }).then(function(modal) {\n                            modalSubsection = modal;\n                            modal.getRoot().on(ModalEvents.save, function(e) {\n                                e.preventDefault(); // We don\"t want to close the modal yet.\n                                var form = $(\"#\" + consts.SUBSECTION_FORM_CONT + \" form\");\n                                $(form).trigger(\"save-form-state\");\n\n                                var data = $(form).serialize();\n                                loadSubsectionForm(data)\n                                    .then(function() {\n                                        const modalEl = modal.getModal();\n                                        if (modalEl.find(\".alert-success\").length) {\n                                            const subsectionId = modalEl.find(\"form input[name='id']\").val();\n                                            window.onbeforeunload = null;\n                                            window.location = M.cfg.wwwroot +\n                                                \"/course/view.php?id=\" +\n                                                courseId+\"#subsection\" +\n                                                subsectionId;\n                                            modal.hide();\n                                            window.location.reload();\n                                        }\n                                    });\n\n                            });\n                            modal.getRoot().on(ModalEvents.cancel, function() {\n                                modal.hide();\n                            });\n                            modal.getRoot().on(ModalEvents.hide, function() {\n                                modal.setBody(\"\");\n                            });\n                            dfd.resolve(modal);\n                        });\n                    } else {\n                        dfd.resolve(modalSubsection);\n                    }\n                    return dfd;\n                };\n\n                var addSubsectionModal = function(el) {\n                    sectionId = $(el).data(\"sectionid\");\n                    var section = $(el).closest(\".section\");\n                    var subSectionCount = section.find(\".subsections .subsection\").length;\n\n                    if (subSectionCount >= 5) {\n                        Str.get_string(\"toomanysubsections\", \"format_visualsections\")\n                            .then(function(str) {\n                                Dialog.error(\n                                    str,\n                                    ''\n                                );\n                            });\n                        return;\n                    }\n\n                    initModal()\n                        .then(function() {\n                            return  Str.get_strings([\n                                {key: \"addsubsection\", component: \"format_visualsections\"}\n                            ]);\n                        })\n                        .then(function(strings) {\n                            modalSubsection.setTitle(strings[0]);\n                            modalSubsection.show();\n                            $(\"#\"+consts.SUBSECTION_FORM_CONT).html(`<div class=\"spinner\"></div>`);\n                            loadSubsectionForm({parentid: sectionId});\n                        });\n                };\n\n                $(\"body\").on(\"click\", \".js-add-subsection\", function() {addSubsectionModal(this);});\n\n                var editSubsectionModal = function(el) {\n                    var subSectionId = $(el).closest(\".subsection\").data(\"subsection-id\");\n                    initModal().then(function() {\n                        return  Str.get_strings([\n                            {key: \"editsubsection\", component: \"format_visualsections\"}\n                        ]);\n                    }).then(function(strings) {\n                        modalSubsection.setTitle(strings[0]);\n                        modalSubsection.show();\n                        $(\"#\"+consts.SUBSECTION_FORM_CONT).html(`<div class=\"spinner\"></div>`);\n                        loadSubsectionForm({id: subSectionId, course: courseId});\n                    });\n\n                };\n\n                $(\"body\").on(\"click\", \".js-edit-subsection\", function() {editSubsectionModal(this);});\n\n                // https://stackoverflow.com/questions/24665602/scrollintoview-scrolls-just-too-far\n                var scrollTo = function(selector, yOffset = 0) {\n                    const el = document.querySelector(selector);\n                    const y = el.getBoundingClientRect().top + window.pageYOffset + yOffset;\n                    window.scrollTo({top: y, behavior: 'smooth'});\n                };\n\n                /**\n                 * Ensures a specific sub section is visible.\n                 * @param hash\n                 */\n                var applySubsectionHash = function(hash) {\n                    if (hash.indexOf('subsection')) {\n                        // This is required when a module redirects us back to the subsection.\n                        hash.replace('subsection', 'subsect');\n                    }\n                    $(\"#section-carousel\").addClass(\"carousel-ready\");\n                    // First we need to make sure that the parent section is displaying.\n                    var parentSection = $(hash.replace('subsect', 'subsection')).closest('.section');\n                    applySectionHash(\"#\" + $(parentSection).attr('id'));\n\n                    // Now scroll the subscetion into the viewport.\n                    var subsectionSel = hash.replace('subsect', 'subsection') + \" > .section\";\n                    Utils.whenTrue(function() {\n                        return typeof(window.$(subsectionSel).collapse) === \"function\";\n                    }).then(function() {\n                        window.$(subsectionSel).collapse(\"show\");\n                        setTimeout(function() {\n                            const nav = $(\".fixed-top.navbar\");\n                            // We need to account for a fixed navbar.\n                            // If there is one then scroll the page to the current hashed\n                            // item but subtract the top by the height of the fixed nav bar.\n                            var subtractTop = nav.length ? nav.outerHeight() : 40;\n                            // Note - 100 is a magic number that I had to add to make it scroll\n                            // to the section top. I don't know why!\n                            scrollTo(subsectionSel, 0 - (100 + subtractTop));\n                        }, 200);\n                    });\n                };\n\n                /**\n                 * Ensures a specific section is visible.\n                 * @param hash\n                 */\n                var applySectionHash = function(hash) {\n                    let section = $(hash);\n                    $(\"ul.visualsections > li.section\").removeClass(\"active\");\n                    $(hash).addClass(\"active\");\n\n                    let sectionHash;\n                    const subSectionCont = $(section).parents('div.subsection');\n                    if (subSectionCont.length) {\n                        // This is a subsection. We want the parent section to be active too.\n                        var parent =  $(subSectionCont).parents('li.section');\n                        $(parent).addClass(\"active\");\n                        // Also the carousel item needs to be the parent section.\n                        sectionHash = $(parent).attr('id');\n                    } else {\n                        sectionHash = hash;\n                    }\n\n                    // Make carousel active.\n                    const regex = /(?:section)-(\\d+)$/;\n                    const match = sectionHash.match(regex);\n                    const sectionNum = match[1];\n                    const carouselItem = $(\"#section-circle-\" + sectionNum).closest(\".carousel-item\");\n\n                    $(\"#section-carousel .carousel-item\").removeClass(\"active\");\n\n                    carouselItem.addClass(\"active\");\n                    let c = 0;\n                    let pos = 0;\n                    $(\"#section-carousel .carousel-item\").each(function() {\n                        c++;\n                        if ($(this).hasClass(\"active\")) {\n                            pos = c;\n                        }\n                    });\n\n                    $(\"#section-carousel .carousel-indicators li\").removeClass(\"active\");\n                    $(\"#section-carousel .carousel-indicators li:nth-child(\" + pos + \")\").addClass(\"active\");\n\n                    $(\"#section-carousel\").addClass(\"carousel-ready\");\n\n                    const params = {courseid: courseId, section: sectionNum};\n                    const contextId = M.cfg.contextid;\n                    Fragment.loadFragment(\"format_visualsections\", \"footer\", contextId, params)\n                        .done(function(html, js) {\n                            if (!$(\"#\" + consts.FOOTER).length) {\n                                return;\n                            }\n                            Templates.replaceNode (\n                                $(\"#\" + consts.FOOTER),\n                                html,\n                                js\n                            );\n                            $(`#${consts.FOOTER} button[data-toggle=\"tooltip\"]`).tooltip();\n                        });\n                };\n\n                /**\n                 * Apply the pages current hash on page load.\n                 * @param calledOnDomReady\n                 */\n                var applyHash = function(calledOnDomReady) {\n                    const hash = location.hash;\n                    if (hash.indexOf(\"#subsect\") === 0) {\n                        applySubsectionHash(hash);\n                    } else if (hash.indexOf(\"#section\") === 0) {\n                        applySectionHash(hash);\n                    } else if (calledOnDomReady && !capViewAllGrades) {\n                        // This is a student, open the default section for this student.\n                        location.hash = \"#\"+defaultSection;\n                    } else {\n                        $(\"#section-carousel\").addClass(\"carousel-ready\");\n                    }\n                };\n\n                $(\"document\").ready(function(e) {\n                    applyHash(true, e);\n                });\n\n                $(window).on(\"hashchange\", function(e) {\n                    applyHash(false, e);\n                });\n\n                // Track activity completion toggles.\n                let activityCompletionToggled = false;\n                $(\"body\").on(\"click\", \".togglecompletion\", function() {\n                    activityCompletionToggled = true;\n                });\n\n                Event.getLegacyEvents().done(function(events) {\n                    $(document).on(events.FILTER_CONTENT_UPDATED, function() {\n                        // Note: replaceNodeContents triggers FILTER_CONTENT_UPDATED,\n                        // so we have to use activityCompletionToggled to be more specific.\n                        if (!activityCompletionToggled) {\n                            return;\n                        }\n                        activityCompletionToggled = false;\n\n                        // Reload carousel.\n                        $('#section-carousel').removeClass('carousel-ready');\n                        const params = {courseid: courseId};\n                        const contextId = M.cfg.contextid;\n\n                        Fragment.loadFragment(\"format_visualsections\", \"carousel\", contextId, params)\n                            .done(function(html, js) {\n                                if (!$(\"#\" + consts.CAROUSEL_CONT).length) {\n                                    return;\n                                }\n                                Templates.replaceNodeContents(\n                                    $(\"#\" + consts.CAROUSEL_CONT),\n                                    html,\n                                    js\n                                );\n                                SectionCircle.applySegments(courseId);\n                                Carousel.init();\n                                applyHash();\n                            });\n                    });\n                });\n\n                $(\"body\").on(\"click\", `#${consts.FOOTER} .js-nav`, function(e) {\n                    e.preventDefault();\n                    if ($(this).attr('disabled')) {\n                        return;\n                    }\n                    const section = $(this).data('section');\n                    location.hash = \"#section-\" + section;\n                });\n\n                $(\"body\").on(\"click\", \".js-move-subsection\", function() {\n                    const direction = $(this).data(\"direction\");\n                    const src = $(this).closest(\"div.subsection\");\n                    const srcSectionId = $(src).data(\"subsection-id\");\n                    let target = null;\n\n                    if (direction === \"up\") {\n                        target = $(src).prev(\"div.subsection\");\n                    } else {\n                        target = $(src).next(\"div.subsection\");\n                    }\n                    let parentSection = $(this).closest(\"li.section\");\n                    let parentSectionId = $(parentSection).data(\"section-id\");\n                    let targetSectionId = null;\n\n                    if (target.length) {\n                        if (direction === \"up\") {\n                            $(src).after(target);\n                        } else {\n                            $(src).before(target);\n                        }\n                        targetSectionId = $(target).data(\"subsection-id\");\n                    } else {\n                        let targetParentSection = null;\n                        if (direction === \"up\") {\n                            targetParentSection = $(parentSection).prev(\"li.section\");\n                        } else {\n                            targetParentSection = $(parentSection).next(\"li.section\");\n                        }\n                        if (targetParentSection.length) {\n                            targetSectionId = srcSectionId; // We just want to dump it into parent section.\n                        } else {\n                            return; // Can\"t move any further.\n                        }\n                        parentSection = targetParentSection;\n                        parentSectionId = parentSection.data(\"section-id\");\n                        parentSection.find(\".subsections\").append(src);\n                    }\n\n                    Ajax.call([\n                        {\n                            methodname: \"format_visualsections_move_subtopic\",\n                            args:{\n                                \"request\": {\n                                    \"parentsectionid\": parentSectionId,\n                                    \"srcsectionid\": srcSectionId,\n                                    \"targetsectionid\": targetSectionId\n                                }\n                            }\n                        }\n                    ])[0]\n                        .then(function(result) {\n                            if (!result.success) {\n                                Str.get_string(\"failedtomovesubsection\", \"format_visualsections\")\n                                    .then(function(str) {\n                                        Dialog.error(\n                                            str,\n                                            ''\n                                        );\n                                    });\n                            }\n                        });\n                });\n            }\n        };\n    });"],"file":"subsections.min.js"}