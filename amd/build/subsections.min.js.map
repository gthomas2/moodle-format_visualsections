{"version":3,"sources":["../src/subsections.js"],"names":["define","$","Y","ModalFactory","ModalEvents","Ajax","Fragment","Templates","Str","Event","Utils","SectionCircle","Carousel","Dialog","consts","SUBSECTION_FORM_CONT","CAROUSEL_CONT","FOOTER","init","courseId","capViewAllGrades","defaultSection","modalSubsection","sectionId","applySegments","use","each","DD","Drop","node","attr","loadSubsectionForm","data","String","URLSearchParams","toString","contextid","M","cfg","params","formdata","loadFragment","done","html","js","length","replaceNodeContents","initModal","dfd","Deferred","bodyHTML","create","title","type","body","large","then","modal","getRoot","on","save","e","preventDefault","form","trigger","serialize","modalEl","getModal","find","subsectionId","val","window","onbeforeunload","location","wwwroot","hide","reload","cancel","setBody","resolve","addSubsectionModal","el","section","closest","subSectionCount","get_string","str","error","get_strings","key","component","strings","setTitle","show","parentid","editSubsectionModal","subSectionId","id","course","applySubsectionHash","hash","addClass","subsectionSel","whenTrue","collapse","setTimeout","nav","subtractTop","outerHeight","animate","scrollTop","offset","top","applySectionHash","removeClass","sectionHash","subSectionCont","parents","parent","regex","match","sectionNum","carouselItem","c","pos","hasClass","contextId","courseid","replaceNode","tooltip","applyHash","calledOnDomReady","indexOf","ready","activityCompletionToggled","getLegacyEvents","events","document","FILTER_CONTENT_UPDATED","direction","src","srcSectionId","target","prev","next","parentSection","parentSectionId","targetSectionId","after","before","targetParentSection","append","call","methodname","args","result","success"],"mappings":"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","sourcesContent":["define(\n    [\n        \"jquery\",\n        \"core/yui\",\n        \"core/modal_factory\",\n        \"core/modal_events\",\n        \"core/ajax\",\n        \"core/fragment\",\n        \"core/templates\",\n        \"core/str\",\n        \"core/event\",\n        \"format_visualsections/utils\",\n        \"format_visualsections/sectioncircle\",\n        \"format_visualsections/carousel\",\n        \"format_visualsections/dialog\"\n    ],\n    function($, Y, ModalFactory, ModalEvents, Ajax, Fragment, Templates, Str, Event, Utils, SectionCircle, Carousel, Dialog) {\n    var consts = {\n        SUBSECTION_FORM_CONT: \"subsectionformcontainer\",\n        CAROUSEL_CONT: \"section-carousel-content\",\n        FOOTER: \"format-footer\"\n    };\n    return {\n        init: function(courseId, capViewAllGrades, defaultSection) {\n            var modalSubsection = null;\n            var sectionId = null;\n\n            SectionCircle.applySegments(courseId);\n\n            Y.use(\"dd-drop\", function(Y) {\n                $(\".subsection\").each(function() {\n                    new Y.DD.Drop({\n                        node: \"#\"+$(this).attr(\"id\")\n                    });\n                });\n            });\n\n            var loadSubsectionForm = function(data) {\n                if (typeof data !== \"string\" && !(data instanceof String)) {\n                    data = new URLSearchParams(data).toString();\n                }\n                const contextid = M.cfg.contextid;\n                const params = data ? {formdata: data} : null;\n\n                return Fragment.loadFragment(\"format_visualsections\", \"subsection_form\", contextid, params)\n                    .done(function(html, js) {\n                        if (!$(\"#\" + consts.SUBSECTION_FORM_CONT).length) {\n                            return;\n                        }\n                        Templates.replaceNodeContents(\n                            $(\"#\" + consts.SUBSECTION_FORM_CONT),\n                            html,\n                            js\n                        );\n                    });\n            };\n\n            var initModal = function() {\n                var dfd = $.Deferred();\n                var bodyHTML = `<div id=\"${consts.SUBSECTION_FORM_CONT}\"></div>`;\n\n                if (!modalSubsection) {\n                    ModalFactory.create({\n                        title: \"\",\n                        type: \"SAVE_CANCEL\",\n                        body: bodyHTML,\n                        large: true,\n                    }).then(function(modal) {\n                        modalSubsection = modal;\n                        modal.getRoot().on(ModalEvents.save, function(e) {\n                            e.preventDefault(); // We don\"t want to close the modal yet.\n                            var form = $(\"#\" + consts.SUBSECTION_FORM_CONT + \" form\");\n                            $(form).trigger(\"save-form-state\");\n\n                            var data = $(form).serialize();\n                            loadSubsectionForm(data)\n                                .then(function() {\n                                    const modalEl = modal.getModal();\n                                    if (modalEl.find(\".alert-success\").length) {\n                                        const subsectionId = modalEl.find(\"form input[name='id']\").val();\n                                        window.onbeforeunload = null;\n                                        window.location = M.cfg.wwwroot+\"/course/view.php?id=\"+courseId+\"#subsection\"+subsectionId;\n                                        modal.hide();\n                                        window.location.reload();\n                                    }\n                                });\n\n                        });\n                        modal.getRoot().on(ModalEvents.cancel, function() {\n                            modal.hide();\n                        });\n                        modal.getRoot().on(ModalEvents.hide, function() {\n                            modal.setBody(\"\");\n                        });\n                        dfd.resolve(modal);\n                    });\n                } else {\n                    dfd.resolve(modalSubsection);\n                }\n                return dfd;\n            };\n\n            var addSubsectionModal = function(el) {\n                sectionId = $(el).data(\"sectionid\");\n                var section = $(el).closest(\".section\");\n                var subSectionCount = section.find(\".subsections .subsection\").length;\n\n                if (subSectionCount >= 5) {\n                    Str.get_string(\"toomanysubsections\", \"format_visualsections\")\n                        .then(function(str) {\n                            Dialog.error(\n                                str,\n                                ''\n                            );\n                        });\n                    return;\n                }\n\n                initModal()\n                .then(function() {\n                    return  Str.get_strings([\n                        {key: \"addsubsection\", component: \"format_visualsections\"}\n                    ]);\n                })\n                .then(function(strings) {\n                    modalSubsection.setTitle(strings[0]);\n                    modalSubsection.show();\n                    $(\"#\"+consts.SUBSECTION_FORM_CONT).html(`<div class=\"spinner\"></div>`);\n                    loadSubsectionForm({parentid: sectionId});\n                });\n            };\n\n            $(\"body\").on(\"click\", \".js-add-subsection\", function() {addSubsectionModal(this);});\n\n            var editSubsectionModal = function(el) {\n                var subSectionId = $(el).closest(\".subsection\").data(\"subsection-id\");\n                initModal().then(function() {\n                    return  Str.get_strings([\n                        {key: \"editsubsection\", component: \"format_visualsections\"}\n                    ]);\n                }).then(function(strings) {\n                    modalSubsection.setTitle(strings[0]);\n                    modalSubsection.show();\n                    $(\"#\"+consts.SUBSECTION_FORM_CONT).html(`<div class=\"spinner\"></div>`);\n                    loadSubsectionForm({id: subSectionId, course: courseId});\n                });\n\n            };\n\n            $(\"body\").on(\"click\", \".js-edit-subsection\", function() {editSubsectionModal(this);});\n\n            var applySubsectionHash = function(hash) {\n                $(\"#section-carousel\").addClass(\"carousel-ready\");\n                var subsectionSel = hash+\" > .section\";\n                Utils.whenTrue(function() {\n                    return typeof(window.$(subsectionSel).collapse) === \"function\";\n                }).then(function() {\n                    window.$(subsectionSel).collapse(\"show\");\n                    setTimeout(function() {\n                        const nav = $(\".fixed-top.navbar\");\n                        // We need to account for a fixed navbar.\n                        // If there is one then scroll the page to the current hashed\n                        // item but subtract the top by the height of the fixed nav bar.\n                        var subtractTop = nav.length ? nav.outerHeight() : 40;\n                        $(\"html, body\").animate({\n                            scrollTop: $(hash).offset().top - subtractTop\n                        }, 200);\n                    }, 200);\n\n                });\n            };\n\n            var applySectionHash = function(hash) {\n                let section = $(hash);\n                $(\"ul.visualsections > li.section\").removeClass(\"active\");\n                $(hash).addClass(\"active\");\n\n                let sectionHash;\n                const subSectionCont = $(section).parents('div.subsection');\n                if (subSectionCont.length) {\n                    // This is a subsection. We want the parent section to be active too.\n                    var parent =  $(subSectionCont).parents('li.section');\n                    $(parent).addClass(\"active\");\n                    // Also the carousel item needs to be the parent section.\n                    sectionHash = $(parent).attr('id');\n                } else {\n                    sectionHash = hash;\n                }\n\n                // Make carousel active.\n                const regex = /(?:section)-(\\d+)$/;\n                const match = sectionHash.match(regex);\n                const sectionNum = match[1];\n                const carouselItem = $(\"#section-circle-\" + sectionNum).closest(\".carousel-item\");\n\n                $(\"#section-carousel .carousel-item\").removeClass(\"active\");\n\n                carouselItem.addClass(\"active\");\n                let c = 0;\n                let pos = 0;\n                $(\"#section-carousel .carousel-item\").each(function() {\n                    c++;\n                    if ($(this).hasClass(\"active\")) {\n                        pos = c;\n                    }\n                });\n\n                $(\"#section-carousel .carousel-indicators li\").removeClass(\"active\");\n                $(\"#section-carousel .carousel-indicators li:nth-child(\" + pos + \")\").addClass(\"active\");\n\n                $(\"#section-carousel\").addClass(\"carousel-ready\");\n\n                const params = {courseid: courseId, section: sectionNum};\n                const contextId = M.cfg.contextid;\n                Fragment.loadFragment(\"format_visualsections\", \"footer\", contextId, params)\n                    .done(function(html, js) {\n                        if (!$(\"#\" + consts.FOOTER).length) {\n                            return;\n                        }\n                        Templates.replaceNode (\n                            $(\"#\" + consts.FOOTER),\n                            html,\n                            js\n                        );\n                        $(`#${consts.FOOTER} button[data-toggle=\"tooltip\"]`).tooltip();\n                    });\n            };\n\n            var applyHash = function(calledOnDomReady) {\n                const hash = location.hash;\n                if (hash.indexOf(\"#subsection\") === 0) {\n                    applySubsectionHash(hash);\n                } else if (hash.indexOf(\"#section\") === 0) {\n                    applySectionHash(hash);\n                } else if (calledOnDomReady && !capViewAllGrades) {\n                    // This is a student, open the default section for this student.\n                    location.hash = \"#\"+defaultSection;\n                } else {\n                    $(\"#section-carousel\").addClass(\"carousel-ready\");\n                }\n            };\n\n            $(\"document\").ready(function(e) {\n                applyHash(true, e);\n            });\n\n            $(window).on(\"hashchange\", function(e) {\n                applyHash(false, e);\n            });\n\n            // Track activity completion toggles.\n            let activityCompletionToggled = false;\n            $(\"body\").on(\"click\", \".togglecompletion\", function() {\n                activityCompletionToggled = true;\n            });\n\n            Event.getLegacyEvents().done(function(events) {\n                $(document).on(events.FILTER_CONTENT_UPDATED, function() {\n                    // Note: replaceNodeContents triggers FILTER_CONTENT_UPDATED,\n                    // so we have to use activityCompletionToggled to be more specific.\n                    if (!activityCompletionToggled) {\n                        return;\n                    }\n                    activityCompletionToggled = false;\n\n                    // Reload carousel.\n                    $('#section-carousel').removeClass('carousel-ready');\n                    const params = {courseid: courseId};\n                    const contextId = M.cfg.contextid;\n\n                    Fragment.loadFragment(\"format_visualsections\", \"carousel\", contextId, params)\n                        .done(function(html, js) {\n                            if (!$(\"#\" + consts.CAROUSEL_CONT).length) {\n                                return;\n                            }\n                            Templates.replaceNodeContents(\n                                $(\"#\" + consts.CAROUSEL_CONT),\n                                html,\n                                js\n                            );\n                            SectionCircle.applySegments(courseId);\n                            Carousel.init();\n                            applyHash();\n                        });\n                });\n            });\n\n            $(\"body\").on(\"click\", `#${consts.FOOTER} .js-nav`, function(e) {\n                e.preventDefault();\n                if ($(this).attr('disabled')) {\n                    return;\n                }\n                const section = $(this).data('section');\n                location.hash = \"#section-\" + section;\n            });\n\n            $(\"body\").on(\"click\", \".js-move-subsection\", function() {\n                const direction = $(this).data(\"direction\");\n                const src = $(this).closest(\"div.subsection\");\n                const srcSectionId = $(src).data(\"subsection-id\");\n                let target = null;\n\n                if (direction === \"up\") {\n                    target = $(src).prev(\"div.subsection\");\n                } else {\n                    target = $(src).next(\"div.subsection\");\n                }\n                let parentSection = $(this).closest(\"li.section\");\n                let parentSectionId = $(parentSection).data(\"section-id\");\n                let targetSectionId = null;\n\n                if (target.length) {\n                    if (direction === \"up\") {\n                        $(src).after(target);\n                    } else {\n                        $(src).before(target);\n                    }\n                    targetSectionId = $(target).data(\"subsection-id\");\n                } else {\n                    let targetParentSection = null;\n                    if (direction === \"up\") {\n                        targetParentSection = $(parentSection).prev(\"li.section\");\n                    } else {\n                        targetParentSection = $(parentSection).next(\"li.section\");\n                    }\n                    if (targetParentSection.length) {\n                        targetSectionId = srcSectionId; // We just want to dump it into parent section.\n                    } else {\n                        return; // Can\"t move any further.\n                    }\n                    parentSection = targetParentSection;\n                    parentSectionId = parentSection.data(\"section-id\");\n                    parentSection.find(\".subsections\").append(src);\n                }\n\n                Ajax.call([\n                    {\n                        methodname: \"format_visualsections_move_subtopic\",\n                        args:{\n                            \"request\": {\n                                \"parentsectionid\": parentSectionId,\n                                \"srcsectionid\": srcSectionId,\n                                \"targetsectionid\": targetSectionId\n                            }\n                        }\n                    }\n                ])[0]\n                    .then(function(result) {\n                        if (!result.success) {\n                            Str.get_string(\"failedtomovesubsection\", \"format_visualsections\")\n                                .then(function(str) {\n                                    Dialog.error(\n                                        str,\n                                        ''\n                                    );\n                                });\n                        }\n                    });\n            });\n        }\n    };\n});"],"file":"subsections.min.js"}